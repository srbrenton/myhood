<html>
<head>
<title>my foreach (2)  box</title>

<style type="text/css">
        html, body { height: 100%; margin: 0; padding: 0; }
        /* Responsive Web Design Fundamentals */
        img, embed, object, video { max-width: 100%; }
        #map { height: 100%; }
        .hl { color:blue;background:pink; }

</style>
</head>

<body>

<div>
<!-- inspired by http://opensoul.org/2011/06/23/live-search-with-knockoutjs/ -->
<form action="#">
<input placeholder="Where I lived ..." type="search" name="q" data-bind="value: query, valueUpdate: 'keyup'" autocomplete="off">
</form>
</div>

<div>
<ul data-bind="foreach: mapLocations">
	<li data-bind="visible: visible()">
	<span data-bind="
		css: { hl: select() },
		text: name,
		event: { mouseover: $parent.highLightOn, mouseout: $parent.highLightOff, click: $parent.listClick }
	" ></span></li>
</ul>
</div>

<script src="jQuery.js"></script>
<script src="bootstrap.min.js"></script>
<script src="knockout-3.2.0.js"></script>

<script>

// AppViewModel() is a function object created on the call to ko.applyBindings()

var myLocations = [
        { name: 'Falmouth', addr: '2190 falmouth anaheim'},
        { name: 'Chanticleer', addr: '8602 chanticleer stanton'},
        { name: 'Lola', addr: '8891 lola anaheim'},
        { name: 'Ball', addr: '2011 w ball rd anaheim'},
        { name: 'Crone', addr: '1842 w crone rd anaheim'},
        { name: 'Tiara', addr: '1639 s tiara way anaheim'}
];

function MapMarker(locInfo) {
	var self = this;
	self.name = locInfo.name;
	self.addr = locInfo.addr;
	self.marker = null;
	self.select = ko.observable(false);
	self.visible = ko.observable(true);
	self.bounce = ko.observable(false);
}

var mapLocations = ko.observableArray([
	new MapMarker(myLocations[0]),
	new MapMarker(myLocations[1]),
	new MapMarker(myLocations[2]),
	new MapMarker(myLocations[3]),
	new MapMarker(myLocations[4]),
	new MapMarker(myLocations[5])
]);

function AppViewModel() {

	var self = this;
	var regex = new RegExp();

	self.query = ko.observable('');

	self.search = function(value) {
//		console.log(mapLocations());
		// create a regex with the value in the search box
		regex.compile(value, 'i');
		// check each name in mapLocations for a match
		for (  var i in mapLocations() ) {
			if ( regex.test(mapLocations()[i].name) ) {
				mapLocations()[i].visible(true);
			}
			else {
				mapLocations()[i].visible(false);
			}
		}
	}

	self.query.subscribe(self.search);

	// toggle with: mapLocations()[0].visible(true)
	this.listClick = function(data) {
		console.log('click for: ' + data.addr);
//		console.log(data);
//		data.visible(false);
	}

	this.highLightOn = function(data) {
		data.select(true);
	}

	this.highLightOff = function(data) {
		data.select(false);
	}

}

ko.applyBindings(new AppViewModel());


</script>
</body>
</html>

